import csv
countlist = []


### This is just creating a large python list where each entry is [value that is being counted, amount counted]. 
##11 works 
#Require 12288 for one block! 
with open('11_D0-D7.csv', 'r') as file:
    reader = csv.reader(file)
    count0 = 0 
    count1 = 0 
    oldvalue = 2 
    for row in reader:
        if (row[1] == "0"): 
            count0 += 1
            if (oldvalue != 0): 
                countlist.append([1,count1])
                count1 = 0 
                oldvalue = 0 
        elif(row[1] == "1"): 
            count1 += 1 
            if (oldvalue != 1): 
                countlist.append([0,count0])
                count0 = 0 
                oldvalue = 1 
    # if(count0 != 0): #Final bits which i just cut off
    #     countlist.append([0,count0])
    # if(count1 != 0): 
    #     countlist.append([1,count1])
##(Remember .1764 ~ 5.66MHZ which is close to the 6.144 MHZ rate we are looking for )
### Through rough calculation of the number of values counted. It is decided that for counted values between 15-21 represent one bit. 
#30 - 40 is for two bits of the same value  50-57 for 3 bits of the same value    
purebits = ""
for value in countlist: 
    if (value[1] >= 13 and value[1]  <= 21): 
        purebits += str(value[0]) 
    elif (value[1] >= 30 and  value[1]  <= 40): 
        purebits += str(value[0])
        purebits += str(value[0]) 
    elif (value[1] >= 48 and  value[1] <= 57): 
        if (value[0] == 0): 
            purebits += "AAA" #These are to Signify the three 1 bits in the preambles 
        elif (value[0]== 1): 
            purebits += "BBB"  #For the three 0 bits. 
print(purebits)
# print(countlist)    

#Beginning BiPhase Decoding 
#Key BBBAAA10 or AAABBB01 is SubFrame1 (LEFT)
#    BBB00100 or AAA11011 is Subframe2 (RIGHT)
#    BBB01AAA or AAA10BBB is START 

decodedstring = ""
insidepreamble = False
preamblecount = 0
currentpreamble = ""

phasecount = 0  #This is for the biphasemark
previousphase = "2" 
for x in purebits:
    if (( x == "A" or x == "B") and (insidepreamble == False)):
        insidepreamble = True 
        preamblecount += 1
        currentpreamble += x  
    elif(insidepreamble and preamblecount < 7): 
        preamblecount += 1
        currentpreamble += x  
    elif(insidepreamble and preamblecount == 7):
        currentpreamble += x  
        if (currentpreamble == "BBBAAA10" or currentpreamble == "AAABBB01"): #These are the specified values of each preamble 
            decodedstring += "LEFT" #Written this way to signify 4 bits 
        if (currentpreamble == "BBB00100" or currentpreamble == "AAA11011"): 
            decodedstring += "RIGH"
        if (currentpreamble == "BBB01AAA" or currentpreamble == "AAA10BBB"): 
            decodedstring += "STAR"
        preamblecount = 0
        insidepreamble = False  
        currentpreamble = ""
    elif(phasecount == 0): 
        phasecount = 1 
        previousphase = x 
    elif(phasecount == 1):  #decoding biphase 
        phasecount = 0 
        if ((previousphase == x) and (previousphase != "2")):  
            decodedstring += "0"
        elif ((previousphase != x ) and (previousphase != "2")): #ERRORS COULD OCCUR HERE   
            decodedstring += "1"
        previousphase = "2"   
    else:
        raise Exception("Something went Wrong")      
# print((decodedstring))
    



# with open('writing.csv', 'w') as csvfile: 
#     # creating a csv writer object 
#     csvwriter = csv.writer(csvfile) 
#     csvwriter.writerow(decodedstring) 
##This one block is just me copying the decoded string From the starting... 
oneblock = ("STAR0000000000010011010111110001RIGH0000000000111011101000000001LEFT0000000001111111110111110000RIGH0000000001110110111000000000LEFT0000000001010100101111110000RIGH0000000010101010000100000001LEFT0000000000001100000000000000RIGH0000000011011000010100000000LEFT0000000000001000001000000000RIGH0000000010111100001100000001LEFT0000000010000011011000000100RIGH0000000001011110101100000000LEFT0000000010000001111000000001RIGH0000000010010010101100000000LEFT0000000010100011111000000001RIGH0000000001011001001100000000LEFT0000000000100001100100000011RIGH0000000000111110101100000011LEFT0000000010001101110100000001RIGH0000000000001100111100000000LEFT0000000001111100001100000001RIGH0000000010111011111100000000LEFT0000000001111101110100000100RIGH0000000001010101111100000000LEFT0000000011001101110100000000RIGH0000000011011011111100000000LEFT0000000011101110001100000000RIGH0000000011010111000010000001LEFT0000000011111011101100000000RIGH0000000000011011010010000000LEFT0000000010011011111100000001RIGH0000000000101110101010000001LEFT0000000011011001100010000001RIGH0000000011011011111010000000LEFT0000000001011011010010000100RIGH0000000000110101100110000001LEFT0000000000001111001010000000RIGH0000000011010100001110000001LEFT0000000010100101111010000000RIGH0000000010011100111110000001LEFT0000000011001111000110000011RIGH0000000000001111000001000001LEFT0000000011110000100110000001RIGH0000000010101000100001000010LEFT0000000000111111100110000001RIGH0000000001111100100001000001LEFT0000000011000111001110000101RIGH0000000011101101010001000000LEFT0000000011001111000001000001RIGH0000000010011010101001000001LEFT0000000000010010110001000001RIGH0000000001001000111001000000LEFT0000000001001010110001000000RIGH0000000000011110011001000001LEFT0000000010010100001001000001RIGH0000000000111111101001000001LEFT0000000011100000011001000000RIGH0000000001010101011001000001LEFT0000000010100011011001000100RIGH0000000011010011011001000000LEFT0000000010010001011001000000RIGH0000000010100110011001000001LEFT0000000011100001011001000001RIGH0000000001000000011001000000LEFT0000000010100100111001000001RIGH0000000001111101101001000001LEFT0000000010101101011001000011RIGH0000000010111111001001000010LEFT0000000010010110001001000000RIGH0000000010011011010001000001LEFT0000000010100010010001000100RIGH0000000000111010000001000001LEFT0000000001101110100001000001RIGH0000000000011101011110000000LEFT0000000000101110100001000000RIGH0000000000100110101110000001LEFT0000000011011100100001000001RIGH0000000010010100001110000000LEFT0000000010010111000001000000RIGH0000000011110010110110000001LEFT0000000000001010100001000000RIGH0000000001100010110110000001LEFT0000000001111111100001000100RIGH0000000010111001110110000001LEFT0000000001010011100001000000RIGH0000000010111110110110000000LEFT0000000011000100000001000000RIGH0000000010000001010110000001LEFT0000000010100111101110000001RIGH0000000001011000100110000000LEFT0000000011110111110110000001RIGH0000000000000100000110000001LEFT0000000011111000100110000000RIGH0000000000001110011010000000LEFT0000000011001110101010000101RIGH0000000010011110110010000101LEFT0000000011000011010010000000RIGH0000000010101101000010000000LEFT0000000010100010000010000000RIGH0000000011000100011100000000LEFT0000000010101100101100000001RIGH0000000001010010110100000000LEFT0000000011001101010100000001RIGH0000000000100111000100000001LEFT0000000010010111000100000000RIGH0000000000011101011000000000LEFT0000000010111011111000000100RIGH0000000001001011001000000001LEFT0000000001100111111000000000RIGH0000000001100000001000000001LEFT0000000011100000000100000000RIGH0000000001010101110000000000LEFT0000000001101100111000000001RIGH0000000000101001010000000000LEFT0000000001001001011000000001RIGH0000000001010010100000000000LEFT0000000001001111011000000001RIGH0000000010110111000000000000LEFT0000000001001100000100000101RIGH0000000010010101100000000001LEFT0000000010101101100100000001RIGH0000000001010100110000000001LEFT0000000001110100010100000000RIGH0000000010000100001000000001LEFT0000000011111001100100000000RIGH0000000001100000001000000001LEFT0000000000111111100100000000RIGH0000000001000010001000000001LEFT0000000011001011110100000000RIGH0000000010001101101000000000LEFT0000000001011110101100000101RIGH0000000010010010111000000000LEFT0000000000100010011100000001RIGH0000000010101100000100000001LEFT0000000010010110111100000000RIGH0000000001010010100100000001LEFT0000000010100000010010000000RIGH0000000011111001110100000001LEFT0000000011100101001010000001RIGH0000000010110001011100000001LEFT0000000011010011001010000001RIGH0000000000011111111100000001LEFT0000000000011100110010000101RIGH0000000011011011111100000000LEFT0000000010011000110010000000RIGH0000000010001001000010000000LEFT0000000001000010101010000001RIGH0000000000001100110010000001LEFT0000000000011101111010000000RIGH0000000011010111101010000001LEFT0000000001101000100110000000RIGH0000000001011000111010000001LEFT0000000011111100010110000001RIGH0000000010111110111010000000LEFT0000000001010000001110000100RIGH0000000010000100000110000000LEFT0000000010010110011110000000RIGH0000000001001010100110000000LEFT0000000010010101000001000001RIGH0000000000101001010110000000LEFT0000000010010110100001000000RIGH0000000010010000110110000000LEFT0000000001110110000001000000RIGH0000000011110011010110000001LEFT0000000000111111011110000000RIGH0000000000010001010110000001LEFT0000000010101001011110000101RIGH0000000000111011010110000000LEFT0000000011010110011110000001RIGH0000000001010010110110000001LEFT0000000000111111001110000001RIGH0000000001100101010110000001LEFT0000000010110000110110000001RIGH0000000011010010100110000001LEFT0000000011000110010110000001RIGH0000000000001100000110000000LEFT0000000010011100010110000001RIGH0000000010001000111010000000LEFT0000000000100001000110000101RIGH0000000000110001001010000100LEFT0000000001001010011010000000RIGH0000000001110010100010000000LEFT0000000011011100001010000001RIGH0000000001100101011100000001LEFT0000000001100111000010000000RIGH0000000000010001110100000001LEFT0000000010110111001100000000RIGH0000000000100000000100000000LEFT0000000011110101010100000000RIGH0000000010101011101000000001LEFT0000000010001000010100000101RIGH0000000001101000101000000100LEFT0000000001101000000100000000RIGH0000000010001101110000000000LEFT0000000011011110001000000001RIGH0000000001111111000000000001LEFT0000000000111010100000000001RIGH0000000011000010011111110000LEFT0000000001011011111111110001RIGH0000000010001010001111110001LEFT0000000001101110111111110001RIGH0000000000100000110111110000LEFT0000000000111010011111110100RIGH0000000010001100100111110001LEFT0000000010011010101111110001RIGH0000000001101110111011110000LEFT0000000010000110101111110000RIGH0000000011011011011011110000LEFT0000000001110101001111110001RIGH0000000011000000011011110000LEFT0000000001100111010111110001RIGH0000000000000010001011110000LEFT0000000000111110100111110001RIGH0000000011100111010011110001LEFT0000000001001010100111110100RIGH0000000011111000110011110001LEFT0000000000111000100111110001RIGH0000000000010011110011110001LEFT0000000011000000000111110001RIGH0000000001101111110011110000LEFT0000000000001010111011110001RIGH0000000000110101001011110001LEFT0000000000101000111011110001RIGH0000000000011111101011110001LEFT0000000000010100011011110000RIGH0000000011011111011011110001LEFT0000000001010010101011110100RIGH0000000001011111111011110001LEFT0000000011110111101011110001RIGH0000000010100111100111110001LEFT0000000010101000111011110000RIGH0000000010100100001111110001LEFT0000000000000001000111110000RIGH0000000011011000011111110001LEFT0000000010111011110111110001RIGH0000000011001100100000000001LEFT0000000011111000000000000001RIGH0000000010101111001000000001LEFT0000000001100010110000000100RIGH0000000011101001111000000000LEFT0000000001001101101000000000RIGH0000000011000110100100000000LEFT0000000010010010000100000000RIGH0000000001100010110100000000LEFT0000000000111110010100000001RIGH0000000001000010101100000001LEFT0000000000111001010100000000RIGH0000000011001101101100000000LEFT0000000010011101100100000001RIGH0000000000001101001100000001LEFT0000000010010110010100000101RIGH0000000011000101001100000000LEFT0000000001111101110100000001RIGH0000000010010001101100000000LEFT0000000000010101010100000001RIGH0000000000001101001100000001LEFT0000000000110100111000000000RIGH0000000000111010100100000000LEFT0000000001010101001000000001RIGH0000000010010000011000000000LEFT0000000001000000001000000000RIGH0000000001100100001000000000LEFT0000000001010110110000000101RIGH0000000000111001010000000001LEFT0000000001011110100000000000RIGH0000000011011000000000000000LEFT0000000010101010011111110001RIGH0000000001111001001111110001LEFT0000000011101011110111110001RIGH0000000011010001100111110000LEFT0000000000011001010111110001RIGH0000000001101101111011110000LEFT0000000000100100100111110000RIGH0000000011111000011011110001LEFT0000000011000110011011110101RIGH0000000010101111110011110000LEFT0000000001110111010011110001RIGH0000000001100011100011110001LEFT0000000011110110000011110000RIGH0000000010100010000011110001LEFT0000000010011100111101110001RIGH0000000001101001111101110001LEFT0000000011100101101101110001RIGH0000000001100101011101110000LEFT0000000001000010110101110000RIGH0000000011100000101101110001LEFT0000000011011000100101110100RIGH0000000001110110110101110100LEFT0000000011110110000101110000RIGH0000000010011001010101110001LEFT0000000010100000100101110001RIGH0000000011000011010101110001LEFT0000000011010110100101110000RIGH0000000010101011010101110000LEFT0000000011100010100101110001RIGH0000000001011010010101110001LEFT0000000011110011000101110000RIGH0000000001011001100101110001LEFT0000000001100011000101110101RIGH0000000010111100100101110000LEFT0000000001001001100101110000RIGH0000000011100011100101110000LEFT0000000011010001010101110001RIGH0000000000110111010101110000LEFT0000000011100010010101110001RIGH0000000011110001110101110001LEFT0000000001100101100101110001RIGH0000000000000111110101110001LEFT0000000011101010110101110001RIGH0000000001101111101101110000LEFT0000000010101001011101110101RIGH0000000011010001100011110001LEFT0000000001110011000011110001RIGH0000000000111110001011110000LEFT0000000010100111100011110000RIGH0000000011011000011011110000LEFT0000000000111101110011110001RIGH0000000010000100000111110001LEFT0000000010110000011011110001RIGH0000000010000011010111110001LEFT0000000010110101111011110000RIGH0000000010100001001111110001LEFT0000000001000011000111110101RIGH0000000011000001101111110000LEFT0000000001010010100111110001RIGH0000000011011101101111110001LEFT0000000011110100100111110001RIGH0000000011110010101111110000LEFT0000000000100111000111110001RIGH0000000000110011001111110000LEFT0000000011000001100111110001RIGH0000000000001011001111110001LEFT0000000000110111010111110001RIGH0000000001100000101111110001LEFT0000000001001101001111110101RIGH0000000000001000101111110000LEFT0000000011100111011111110001RIGH0000000011110100101111110000LEFT0000000000111000100000000000RIGH0000000001000100101111110001LEFT0000000001101101010000000000RIGH0000000010011001001111110000LEFT0000000010101111110000000000RIGH0000000001010011110111110001LEFT0000000010100100101000000001RIGH0000000000101010110111110000LEFT0000000001100000101000000101RIGH0000000010011010010111110000LEFT0000000010010111110000000001RIGH0000000001110000100111110001LEFT0000000000111111010000000001RIGH0000000001100101000111110001LEFT0000000010110100010000000001RIGH0000000010100011000111110001LEFT0000000000001111000000000000RIGH0000000000011011000111110001LEFT0000000010000110011111110000RIGH0000000011001000000111110000LEFT0000000001000011110111110101RIGH0000000001010000111011110001LEFT0000000001011110110111110000RIGH0000000000001001111011110001LEFT0000000011100001001111110000RIGH0000000010110100100111110000LEFT0000000011011100001111110001RIGH0000000001000101100111110001LEFT0000000011010111010111110000RIGH0000000010100011000111110001LEFT0000000011011100010111110001RIGH0000000000010111111011110001LEFT0000000000111011010111110100RIGH0000000001110111111011110100LEFT0000000010011011110111110000RIGH0000000001100101000111110001LEFT0000000011000000001111110000RIGH0000000001101111000111110001LEFT0000000000100001110111110001RIGH0000000011110101000111110001LEFT0000000000000111010111110001RIGH0000000010011110000111110000LEFT0000000010001011010111110000RIGH0000000000011000100111110000LEFT0000000010110000110111110101RIGH0000000001111110010111110000STAR0000000001001101010111110000RIGH0000000000100101110111110000LEFT0000000010001111100111110001RIGH0000000010000000001111110001LEFT0000000001000111100111110000RIGH0000000010110010001111110000LEFT0000000011100001010111110000RIGH0000000011010011001111110001LEFT0000000001101000110111110000RIGH0000000011111011001111110001LEFT0000000001000001110111110100RIGH0000000001110110001111110001LEFT0000000001010000001111110000RIGH0000000010100011110111110001LEFT0000000010110001001111110000RIGH0000000011001000110111110000LEFT0000000000101110001111110011RIGH0000000001110100010111110011LEFT0000000000101101110111110001RIGH0000000010001000100111110000LEFT0000000010010100010111110001RIGH0000000011001101111011110000LEFT0000000010010101111011110100RIGH0000000000000011101011110000LEFT0000000000000010101011110001RIGH0000000010100011110011110000LEFT0000000010100100001011110000RIGH0000000010111111010011110000LEFT0000000010111110110011110000RIGH0000000010010111010011110000LEFT0000000011100100010011110001RIGH0000000011010100010011110001LEFT0000000011100010100011110001RIGH0000000001001001100011110000LEFT0000000000011010100011110101RIGH0000000000010011100011110101LEFT0000000000110011000011110000RIGH0000000000000011100011110001LEFT0000000001001110111101110001RIGH0000000011100100100011110001LEFT0000000010100101011101110011RIGH0000000010011101000011110001LEFT0000000010000011011101110001RIGH0000000010101011000011110010LEFT0000000010011000111101110000RIGH0000000001101100100011110001LEFT0000000011000010111101110101RIGH0000000001100110100011110001LEFT0000000000011010111101110000RIGH0000000010111111000011110001LEFT0000000001001000000011110000RIGH0000000001101101000011110001LEFT00000000")
oneblock = oneblock[0:12288]
with open('decodedbitstring.txt', 'w') as f:
    channelbits1 = ""
    channelbits2 = ""
    
    for i in range(192): 
        f.write(f"{i+1}: \n")
        f.write(oneblock[(2*i)*32:((2*i)+1)*32][0:4] + " " + oneblock[(2*i)*32:((2*i)+1)*32][4:8] + " " + oneblock[(2*i)*32:((2*i)+1)*32][8:28] + " " + oneblock[(2*i)*32:((2*i)+1)*32][28:32])
        channelbits1 += oneblock[(2*i)*32:((2*i)+1)*32][30] 
        f.write("\n")
        f.write(oneblock[((2*i)+1)*32:((2*i)+2)*32][0:4] + " " + oneblock[((2*i)+1)*32:((2*i)+2)*32][4:8]  + " "  + oneblock[((2*i)+1)*32:((2*i)+2)*32][8:28] + " " + oneblock[((2*i)+1)*32:((2*i)+2)*32][28:32])
        channelbits2 += oneblock[((2*i)+1)*32:((2*i)+2)*32][30]
        f.write("\n")
    f.write("CHANNEL1 BITS: ")
    f.write(channelbits1) 
    f.write("\n") 
    f.write("CHANNEL2 BITS: ")
    f.write(channelbits2) 
    f.write("\n") 
      